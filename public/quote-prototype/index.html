<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8" />
    <title>Preventivo Parametrico - Altramusica</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap 5 CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="app-header mb-3">
        <div class="container-fluid px-3">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="h4 mb-1">Preventivo Parametrico - Prototipo Altramusica</h1>
                    <p class="subtitle mb-0">
                        Seleziona le funzionalità, assegnale alle fasi e regola i parametri per simulare tempi e costi.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <main class="container-fluid px-3 pb-4">
        <!-- Barra filtri + parametri -->
        <section class="row g-3 mb-3">
            <div class="col-lg-6">
                <div class="card shadow-sm bg-dark-panel h-100">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Filtri funzioni</h2>
                        <div class="row g-2 align-items-end">
                            <div class="col-md-6">
                                <label class="form-label form-label-sm">Macro-area</label>
                                <select id="macroAreaFilter" class="form-select form-select-sm">
                                    <option value="">Tutte</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label form-label-sm">Ricerca</label>
                                <input
                                    type="text"
                                    id="searchFilter"
                                    class="form-control form-control-sm"
                                    placeholder="Cerca per titolo o tag..."
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card shadow-sm bg-dark-panel h-100">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Parametri di calcolo</h2>
                        <div class="row g-2">
                            <div class="col-sm-4">
                                <label class="form-label form-label-sm">Tariffa giornaliera (€)</label>
                                <input
                                    type="number"
                                    id="ratePerDay"
                                    class="form-control form-control-sm"
                                    value="300"
                                    min="0"
                                    step="10"
                                />
                            </div>
                            <div class="col-sm-4">
                                <label class="form-label form-label-sm">Ore per giorno</label>
                                <input
                                    type="number"
                                    id="hoursPerDay"
                                    class="form-control form-control-sm"
                                    value="6"
                                    min="1"
                                    max="10"
                                    step="0.5"
                                />
                            </div>
                            <div class="col-sm-4">
                                <label class="form-label form-label-sm">Ore per punto</label>
                                <input
                                    type="number"
                                    id="hoursPerPoint"
                                    class="form-control form-control-sm"
                                    value="0.15"
                                    min="0.01"
                                    step="0.01"
                                />
                            </div>
                            <div class="col-12 mt-2">
                                <label class="form-label form-label-sm d-flex justify-content-between">
                                    <span>Accelerazione IA (solo meccaniche)</span>
                                    <span id="aiFactorLabel" class="small text-muted">15%</span>
                                </label>
                                <input
                                    type="range"
                                    id="aiFactor"
                                    min="0"
                                    max="30"
                                    value="15"
                                    class="form-range"
                                />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Libreria funzioni -->
        <section class="row g-3 mb-3">
            <div class="col-12">
                <div class="card shadow-sm bg-dark-panel">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h2 class="card-title h6 mb-0">Libreria funzioni</h2>
                            <small class="text-muted">
                                Trascina le card nelle fasi per comporre il preventivo.
                            </small>
                        </div>
                        <div
                            id="libraryList"
                            class="card-list droppable border-0"
                            data-phase="unassigned"
                        >
                            <!-- Cards from data.js -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Board fasi + riepilogo -->
        <section class="row g-3">
            <div class="col-xl-9">
                <div class="card shadow-sm bg-dark-panel">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Fasi progettuali</h2>
                        <div class="row g-3">
                            <div class="col-md-6 col-xl-3">
                                <div class="phase-column">
                                    <h3 class="h6 mb-2">Fase 1</h3>
                                    <div
                                        class="card-list droppable"
                                        data-phase="phase1"
                                        id="phase1List"
                                    ></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-3">
                                <div class="phase-column">
                                    <h3 class="h6 mb-2">Fase 2</h3>
                                    <div
                                        class="card-list droppable"
                                        data-phase="phase2"
                                        id="phase2List"
                                    ></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-3">
                                <div class="phase-column">
                                    <h3 class="h6 mb-2">Fase 3</h3>
                                    <div
                                        class="card-list droppable"
                                        data-phase="phase3"
                                        id="phase3List"
                                    ></div>
                                </div>
                            </div>
                            <div class="col-md-6 col-xl-3">
                                <div class="phase-column">
                                    <h3 class="h6 mb-2">Fase 4</h3>
                                    <div
                                        class="card-list droppable"
                                        data-phase="phase4"
                                        id="phase4List"
                                    ></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3">
                <div class="card shadow-sm bg-dark-panel mb-3">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Riepilogo per fase</h2>
                        <div class="table-responsive">
                            <table class="table table-sm table-dark table-borderless align-middle mb-2">
                                <thead>
                                    <tr>
                                        <th>Fase</th>
                                        <th class="text-end">Punti</th>
                                        <th class="text-end">Giorni</th>
                                        <th class="text-end">Costo (€)</th>
                                    </tr>
                                </thead>
                                <tbody id="phaseSummaryBody">
                                    <!-- Filled by JS -->
                                </tbody>
                                <tfoot>
                                    <tr class="fw-semibold border-top">
                                        <td>Totale</td>
                                        <td id="totalPoints" class="text-end">0</td>
                                        <td id="totalDays" class="text-end">0</td>
                                        <td id="totalCost" class="text-end">0</td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm bg-dark-panel mb-3">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Dipendenze e warning</h2>
                        <div id="warningsList" class="warnings-list">
                            <!-- Filled by JS -->
                        </div>
                    </div>
                </div>

                <div class="card shadow-sm bg-dark-panel">
                    <div class="card-body">
                        <h2 class="card-title h6 mb-3">Esportazione</h2>
                        <button id="exportMarkdownBtn" class="btn btn-primary btn-sm w-100 mb-2">
                            Esporta preventivo (Markdown)
                        </button>
                        <textarea
                            id="exportOutput"
                            class="form-control form-control-sm export-output"
                            readonly
                            placeholder="Il testo Markdown generato verrà mostrato qui se la copia automatica non è disponibile."
                        ></textarea>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="data.js"></script>
    <script src="app.js"></script>

    <!--
    NOTE PER ESTENDERE IL DATASET

    - Per aggiungere una nuova funzione atomica:
      1. Apri il file data.js
      2. Aggiungi un nuovo oggetto nell'array window.FUNCTIONS, ad esempio:

         {
             id: "func_new",
             title: "Nuova funzionalità di esempio",
             macroArea: "Anagrafiche e anni scolastici",
             tags: ["meccanica"],
             effortPoints: 5,
             dependencies: [
                 { id: "func_student_crud", type: "hard" }
             ],
             groupKey: "anagrafica_studenti",
             notes: "Nota opzionale"
         }

    - Per aggiungere una dipendenza:
      - Inserisci un oggetto nella proprietà dependencies della funzione:
        { id: "id_funzione_dipendente", type: "hard" } oppure type: "soft"

    - Per cambiare i punti (effortPoints):
      - Modifica il valore numerico di effortPoints per la funzione.
      - I calcoli di giorni e costi si aggiorneranno automaticamente.
    -->
</body>
</html>


